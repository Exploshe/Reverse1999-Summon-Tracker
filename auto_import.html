<!DOCTYPE html>

<html>
    <head>
        <title>Auto Import</title>
        <style>
            body {
                background-color: rgb(62, 52, 125);
                color: white;
            }
        </style>
    </head>
    <body>
        <div>
            <div>step 1: download fiddler classic https://www.telerik.com/download/fiddler</div>
            <div>step 2: Open Fiddler Classic, go to “Tools” -> “Options” -> “HTTPS” and select “Decrypt HPPS Traffic” and accept certificate</div>
            <div>step 3: open the summon history in game</div>
            <div>step 4: go back to fiddler and ctrl f query/summon, right click -> copy -> just url and paste here :)</div>
        </div>
        hi :)
        <input class="link" placeholder="Paste the link here" onkeydown="if (event.key === 'Enter') {importSummon()}">
        <button onclick="importSummon()" class="js-import-button">Import</button>
        <a style="color: white;" href="index.html">back to summon tracker</a>
        
        <script>
            function importSummon() {
                let url = document.querySelector(".link").value;
                url = 'https://corsproxy.io/?' + encodeURIComponent(url);
                document.querySelector(".link").value = "";
                
                const characterIds = {"3003":{"name":"Druvis III","rarity":6},"3004":{"name":"Lilya","rarity":6},"3005":{"name":"Nick Bottom","rarity":4},"3006":{"name":"Eagle","rarity":4},"3007":{"name":"A Knight","rarity":6},"3009":{"name":"Sotheby","rarity":6},"3010":{"name":"X","rarity":5},"3011":{"name":"Sweetheart","rarity":5},"3012":{"name":"The Fool","rarity":3},"3013":{"name":"3има","rarity":4},"3014":{"name":"Bunny Bunny","rarity":4},"3015":{"name":"Pavia","rarity":4},"3016":{"name":"Baby Blue","rarity":5},"3017":{"name":"Charlie","rarity":5},"3018":{"name":"Oliver Fog","rarity":4},"3020":{"name":"Bkornblume","rarity":5},"3022":{"name":"Dikke","rarity":5},"3023":{"name":"Sonetto","rarity":5},"3024":{"name":"Balloon Party","rarity":5},"3025":{"name":"Regulus","rarity":6},"3026":{"name":"Mondlicht","rarity":4},"3027":{"name":"Ms. Radio","rarity":2},"3028":{"name":"APPLe","rarity":4},"3029":{"name":"Schneider","rarity":5},"3030":{"name":"La Source","rarity":3},"3031":{"name":"Cristallo","rarity":4},"3032":{"name":"Centurion","rarity":6},"3033":{"name":"TTT","rarity":4},"3034":{"name":"aliEn T","rarity":3},"3035":{"name":"Leilani","rarity":3},"3036":{"name":"John Titor","rarity":3},"3037":{"name":"Necrologist","rarity":5},"3038":{"name":"Satsuki","rarity":5},"3039":{"name":"An-an Lee","rarity":6},"3040":{"name":"Twins Sleep","rarity":3},"3041":{"name":"Matilda Bouanich","rarity":5},"3042":{"name":"Rabies","rarity":4},"3043":{"name":"Tennant","rarity":5},"3044":{"name":"Ms. Moissan","rarity":4},"3045":{"name":"Bette","rarity":3},"3046":{"name":"Poltergeist","rarity":4},"3047":{"name":"Medicine Pocket","rarity":6},"3048":{"name":"Voyager","rarity":6},"3049":{"name":"Click","rarity":5},"3050":{"name":"Darley Clatter","rarity":3},"3051":{"name":"Eternity","rarity":6},"3052":{"name":"Ms. NewBabel","rarity":6},"3053":{"name":"Tooth Fairy","rarity":6},"3054":{"name":"ONiON","rarity":3},"3055":{"name":"Sputnik","rarity":3},"3056":{"name":"Changeling","rarity":6},"3057":{"name":"Mesmer Jr.","rarity":4},"3058":{"name":"Erick","rarity":4},"3059":{"name":"Door","rarity":2},"3060":{"name":"Blonney","rarity":5},"3061":{"name":"Horropedia","rarity":5},"3062":{"name":"Melania","rarity":6},"3063":{"name":"Pickles","rarity":6},"3064":{"name":"Diggers","rarity":5},"3066":{"name":"Thirty-seven","rarity":6},"3070":{"name":"Black Dwarf","rarity":6},"3071":{"name":"Kanjira","rarity":5},"3072":{"name":"Shamane","rarity":6},"3073":{"name":"Spathodea","rarity":6},"3074":{"name":"Ezra Theodore","rarity":6},"3075":{"name":"Desert Flannel","rarity":5},"3076":{"name":"Ulu","rarity":5},"3079":{"name":"Six","rarity":6}}
                
                async function makeRequest() {
                    try {
                        const xhttp = new XMLHttpRequest();
                        xhttp.open("GET", url);
                        xhttp.send();
                        xhttp.onreadystatechange = function() {
                            if (xhttp.readyState === 4 && xhttp.status === 200) {
                                const res = JSON.parse(xhttp.responseText);
                                if (res.code === 200) {
                                    const summons = res.data.pageData;
                                    let limitedLifetimePulls = 0;
                                    let limitedBanner6StarPity = 0
                                    let limitedBanner5StarPity = 0
                                    for (let i = summons.length - 1; i >= 0; i--) {
                                        const summon = summons[i];
                                        for (let j = 0; j < summon.gainIds.length; j++) {
                                            const id = summon.gainIds[j];
                                            // Beginner banner
                                            if (summon.poolType === 1) {}
                                            // Standard banner
                                            else if (summon.poolType === 2) {}
                                            // Limited banner
                                            else if (summon.poolType === 3) {
                                                limitedLifetimePulls++;
                                                limitedBanner6StarPity++;
                                                limitedBanner5StarPity++;
                                                if (characterIds[`${id}`].rarity === 6) {
                                                    limitedBanner6StarPity = 0;
                                                } else if (characterIds[`${id}`].rarity === 5) {
                                                    limitedBanner5StarPity = 0
                                                }
                                            }
                                        };
                                    };
                                    localStorage.setItem("limitedLifetimePulls", limitedLifetimePulls);
                                    localStorage.setItem("limitedBanner6StarPity", limitedBanner6StarPity);
                                    localStorage.setItem("limitedBanner5StarPity", limitedBanner5StarPity);
                                } else {
                                    console.log("Expired or invalid link");
                                }
                            }
                        }
                        
                        
                        
                    } catch (error) {
                        console.error('Error making the request:', error.message);
                    }
                }
    
                makeRequest();
            }
        </script>
    </body>
</html>